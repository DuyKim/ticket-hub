build:
  # You can use the following env vars to refer to this image in your deploy commands:
  #  - OKTETO_BUILD_AUTH_REGISTRY: image registry
  #  - OKTETO_BUILD_AUTH_REPOSITORY: image repo
  #  - OKTETO_BUILD_AUTH_IMAGE: image name
  #  - OKTETO_BUILD_AUTH_SHA: image tag sha256
  auth:
    context: auth
    dockerfile: Dockerfile
  client:
    context: client
    dockerfile: Dockerfile
  tickets:
    context: tickets
    dockerfile: Dockerfile

deploy:
  - kubectl apply -f k8s

dev:
  auth:
    image: registry.cloud.okteto.net/duykim/ticketing-auth
    command: sh
    workdir: /usr/src/app
    sync:
      - auth:/usr/src/app
    forward:
      - 3001:3001
  client:
    image: okteto.dev/ticketing-client
    command: sh
    workdir: /usr/src/app
    sync:
      - client:/usr/src/app
    forward:
      - 3000:3000
  tickets:
    image: okteto.dev/ticketing-tickets
    command: sh
    workdir: /usr/src/app
    sync:
      - client:/usr/src/app
    forward:
      - 3002:3002
